---
title: "STAT 653, HW3"
author: "Min Tamang"
date: ' April 12, 2020'
output:
  word_document: default
  html_notebook: default
---

Problems:
Run the R code from Chapter 4. 04-word-combinations.Rmd Use the R Project I have provided. ngrams.zip Some of the code needs to be changed to make a Word Document.
Make a network graph of one of the Harry Potter books or choose a different book from Gutenberg.


##Run the R code from Chapter 3. 03-tf-idf.Rmd

**3.1 Term frequency in Jane Austen's novels**
```{r}
library(tidyverse)
library(tidytext)
library(janeaustenr)

book_words <- austen_books() %>% unnest_tokens(word,text) %>% 
  count(book,word,sort = TRUE)
total_words <- book_words %>%group_by(book) %>% summarise(total = sum(n))
book_words <- left_join(book_words, total_words)
head(book_words)
```

```{r}
#distribution of stop words
ggplot(book_words, aes(n/total, fill=book)) + geom_histogram(show.legend = F)+
  xlim(NA,0.0009) + facet_wrap(~book, ncol = 2, scales = "free_y")
```


**3.2 Zip's law**
```{r}
freq_by_rank <- book_words %>% group_by(book) %>% 
  mutate(rank = row_number(),'term frequency' = n/total)
head(freq_by_rank)
                                                         
```

```{r}
#visualize Zips'f law
freq_by_rank %>% 
  ggplot(aes(rank, `term frequency`, color = book)) + 
  geom_line(size = 1.1, alpha = 0.8, show.legend = FALSE) + 
  scale_x_log10() +
  scale_y_log10()
```

```{r}
rank_subset <- freq_by_rank %>% 
  filter(rank < 500,
         rank > 10)

lm(log10(`term frequency`) ~ log10(rank), data = rank_subset)
```

```{r}
#Fitting an exponent
freq_by_rank %>% 
  ggplot(aes(rank, `term frequency`, color = book)) + 
  geom_abline(intercept = -0.62, slope = -1.1, color = "gray50", linetype = 2) +
  geom_line(size = 1.1, alpha = 0.8, show.legend = FALSE) + 
  scale_x_log10() +
  scale_y_log10()
```



**3.3 The bind_tf_idf function**
```{r}
book_words <- book_words %>% bind_tf_idf(word, book, n)
head(book_words,10)
tail(book_words,10)
```

```{r}
#high tf-idf
top_n(book_words %>% select(-total) %>% arrange(desc(tf_idf)),20)
                                               
```


```{r}
#visualize tf_idf
book_words %>%
  arrange(desc(tf_idf)) %>%
  mutate(word = factor(word, levels = rev(unique(word)))) %>% 
  group_by(book) %>% 
  top_n(10) %>% 
  ungroup() %>%
  ggplot(aes(word, tf_idf, fill = book)) +
  geom_col(show.legend = FALSE) +
  labs(x = NULL, y = "tf-idf") +
  facet_wrap(~book, ncol = 2, scales = "free") +
  coord_flip()
```

**3.4 A corpus of physics texts**
```{r}
library(gutenbergr)
physics <- gutenberg_download(c(37729,14725,13476,30155), meta_fields = "author")
```

```{r}
# number of times words used
physics_words <- physics %>% unnest_tokens(word,text) %>% count(author, word, sort = TRUE)
head(physics_words)
```

```{r}
#tf_idf 
library(forcats)

plot_physics <- physics_words %>%
  bind_tf_idf(word, author, n) %>%
  mutate(word = fct_reorder(word, tf_idf)) %>%
  mutate(author = factor(author, levels = c("Galilei, Galileo",
                                            "Huygens, Christiaan", 
                                            "Tesla, Nikola",
                                            "Einstein, Albert")))
head(plot_physics)
```
```{r}
#visualize
plot_physics %>% 
  group_by(author) %>% 
  top_n(15, tf_idf) %>% 
  ungroup() %>%
  mutate(word = reorder(word, tf_idf)) %>%
  ggplot(aes(word, tf_idf, fill = author)) +
  geom_col(show.legend = FALSE) +
  labs(x = NULL, y = "tf-idf") +
  facet_wrap(~author, ncol = 2, scales = "free") +
  coord_flip()
```

```{r}
library(stringr)
#see "k"
physics %>% 
  filter(str_detect(text, "_k_")) %>% 
  select(text)
```

```{r}
#remove stop words
mystopwords <- tibble(word = c("eq", "co", "rc", "ac", "ak", "bn", 
                                   "fig", "file", "cg", "cb", "cm",
                               "ab", "_k", "_k_", "_x"))

physics_words <- anti_join(physics_words, mystopwords, 
                           by = "word")
#tf-idf
plot_physics <- physics_words %>%
  bind_tf_idf(word, author, n) %>%
  mutate(word = str_remove_all(word, "_")) %>%
  group_by(author) %>% 
  top_n(15, tf_idf) %>%
  ungroup() %>%
  mutate(word = reorder_within(word, tf_idf, author)) %>%
  mutate(author = factor(author, levels = c("Galilei, Galileo",
                                            "Huygens, Christiaan",
                                            "Tesla, Nikola",
                                            "Einstein, Albert")))
#visualize
ggplot(plot_physics, aes(word, tf_idf, fill = author)) +
  geom_col(show.legend = FALSE) +
  labs(x = NULL, y = "tf-idf") +
  facet_wrap(~author, ncol = 2, scales = "free") +
  coord_flip() +
  scale_x_reordered()
```



## Run the code from frequencies.R on the harrypotter data.

```{r}
library(harrypotter)

```

```{r}

library(tidyverse)      # data manipulation & plotting
library(stringr)        # text cleaning and regular expressions
library(tidytext)       # provides additional text mining functions
library(harrypotter)    # provides the first seven novels of the Harry Potter series

philosophers_stone[1]
chamber_of_secrets[1]
prisoner_of_azkaban[1]
goblet_of_fire[1]
order_of_the_phoenix[1]
half_blood_prince[1]
deathly_hallows[1]


text_tb <- tibble(chapter = seq_along(philosophers_stone),
                  text = philosophers_stone)
text_tb

text_tb %>%
  unnest_tokens(word, text)

library(janeaustenr)
library(dplyr)
library(stringr)

original_books <- austen_books() %>%
  group_by(book) %>%
  mutate(linenumber = row_number(),
         chapter = cumsum(str_detect(text, regex("^chapter [\\divxlc]",
                                                 ignore_case = TRUE)))) %>%
  ungroup()

original_books

# all books

titles <- c("Philosopher's Stone", "Chamber of Secrets", "Prisoner of Azkaban",
            "Goblet of Fire", "Order of the Phoenix", "Half-Blood Prince",
            "Deathly Hallows")

books <- list(philosophers_stone, chamber_of_secrets, prisoner_of_azkaban,
              goblet_of_fire, order_of_the_phoenix, half_blood_prince,
              deathly_hallows)

series <- tibble()

for(i in seq_along(titles)) {
  
  clean <- tibble(chapter = seq_along(books[[i]]),
                  text = books[[i]]) %>%
    unnest_tokens(word, text) %>%
    mutate(book = titles[i]) %>%
    select(book, everything())
  
  series <- rbind(series, clean)
}
```


